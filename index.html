<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Zombie Pix</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="entities/entity.js"></script>
        <script src="entities/tile.js"></script>
        <script src="entities/map.js"></script>
        <script src="entities/cursor.js"></script>
        <script src="entities/camera.js"></script>
        <script src="entities/zombiekiller.js"></script>
        <script src="entities/zombie.js"></script>
        <script src="entities/bullet.js"></script>
        <script src="entities/tower.js"></script>
        <script src="utils/priorityqueue.js"></script>
        <script src="utils/assets.js"></script>
        <script src="utils/atlas.js"></script>
        <script src="utils/animation.js"></script>
        <script src="controller.js"></script>
        <script src="render.js"></script>
        <script type="text/javascript">
            var canvas = null;
            var context = null;
            var prevTime = 0;
            var render = null;
            var cursor = Cursor.getInstance();
            
            window.onload = function() {
                canvas = document.getElementById("canvas");
                canvas.width = 800;
                canvas.height = 800;
                context = canvas.getContext("2d");
                var assets = Assets.getInstance();
                assets.loadAll(onLoadAssets);
            };
            
            function update(currTime) {
                var diff = currTime - prevTime;
                var deltatime = diff / 1000;
                prevTime = currTime;
                render.update(deltatime);
                window.requestAnimationFrame(update);
            }
            
            function onLoadAssets() {
                var atlas = Atlas.getInstance();
                atlas.loadAll(onLoadAtlas);
            }
            
            function onLoadAtlas() {
                canvas.addEventListener("mousemove", function(evt) {
                    var rect = canvas.getBoundingClientRect();
                    var x = evt.clientX - rect.left;
                    var y = evt.clientY - rect.top;
                    cursor.update(x, y);
                });
                
                canvas.addEventListener("mousedown", function(evt) {
                    cursor.isPressed = true;
                });

                canvas.addEventListener("mouseup", function(evt) {
                    cursor.isPressed = false;
                });
                
                render = new Render(canvas, context);
                var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
                window.requestAnimationFrame = requestAnimationFrame;
                window.requestAnimationFrame(update);
            }
        </script>
    </head>
    <body>
        <canvas id="canvas"></canvas>
    </body>
</html>
